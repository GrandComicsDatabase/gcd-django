{% extends "mycomics/tw_base_view.html" %}
{% load i18n %}
{% load collecting %}
{% load django_tables2 %}
{% load static %}

{% block nav_bar %}
  {{ block.super }}
<nav class="flex items-center justify-between flex-wrap bg-red-100 px-1 lg:px-2">
  <div class="flex-1 font-bold text-2xl self-start">
Reading List: {{ reading_order.name }}
  </div>
  {% with mycomics_red=True %}
    {% include "gcd/bits/tw_pagination_bar.html" %}
  {% endwith %}
</nav>
{% endblock %}

{% block view_body %}
  {% if messages %}
<ul class="messages">
    {% for message in messages %}
  <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
    {% endfor %}
</ul>
  {% endif %}
<div class="flex">
  <div class="flex-1 items-start"> <!-- content -->
  {% if reading_order.description %}
    <p class="mt-1">{{ reading_order.description }}</p>
  {% endif %}
  </div>
  <div class="flex justify-end"> <!-- editing -->
  {% if request.user.collector == reading_order.collector %}
  <div class="btn-group pull-right">
    <a class="hover:no-underline" href="{% url 'edit_reading_order' reading_order.id %}">
      <btn class="btn-blue-editing">{% trans "Edit Reading List" %}
    </btn></a>
  </div>
  {% else %} 
    {% if request.user.collector %}
  <div class="btn-group my-1 pull-right">
    provided by <a href="{{ reading_order.collector.user.get_absolute_url }}">{{ reading_order.collector.user.indexer }}</a>  
    <a class="hover:no-underline" href="{% url 'copy_reading_order' reading_order.id %}">
      <btn class="inline btn-blue-editing">{% trans "Copy Reading List" %}
    </btn></a>
  </div>
    {% else %}
    provided by {{ reading_order.collector.user.indexer }}
    {% endif %}
  {% endif %}
  </div>
</div>
  {% render_table table %}
<script type="text/javascript" src="{% static 'js/htmx.min.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  document.addEventListener("htmx:confirm", function(e) {
    // The event is triggered on every trigger for a request, so we need to check if the element
    // that triggered the request has a confirm question set via the hx-confirm attribute,
    // if not we can return early and let the default behavior happen
    if (!e.detail.question) return

    // This will prevent the request from being issued to later manually issue it
    e.preventDefault()

    Swal.fire({
      title: "Proceed?",
      html: `${e.detail.question}`,
      showCancelButton: true,
      customClass: {
          popup: "!relative !transform !overflow-hidden !rounded-lg !bg-white !text-left !shadow-xl !transition-all sm:!my-8 sm:!w-full sm:!max-w-lg !p-0 !grid-cols-none",
          title: "!p-0 !pt-3 !text-center sm:!text-left !text-base !font-semibold !leading-6 !text-gray-900 !pl-4 !pr-4 sm:!pr-6 sm:!pl-0 sm:!pt-6 sm:!ml-4 !col-start-1 sm:!col-start-2 !col-end-3",
          htmlContainer: "!mt-2 sm:!mt-0 !m-0 !text-center sm:!text-left !text-sm !pl-4 sm:!pl-0 !pr-4 !pb-4 sm:!pr-6 sm:!pb-4 sm:!ml-4 !col-start-1 sm:!col-start-2 !col-end-3",
          actions: "sm:!flex sm:!flex-row-reverse sm:!px-6 !w-full !justify-start !mt-0 !mb-4 !col-start-1 !col-end-3",
          confirmButton: "inline-flex w-full bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm !ring-2 !ring-inset ring-blue-500 hover:bg-blue-500 sm:w-auto",
          cancelButton: "inline-flex w-full bg-gray-200 px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-2 ring-inset ring-gray-300 hover:bg-gray-300 sm:w-auto",
      },      
    }).then(function(result) {
      if (result.isConfirmed) {
        // If the user confirms, we manually issue the request
        e.detail.issueRequest(true); // true to skip the built-in window.confirm()
      }
    })
  })
</script>
{% endblock %}
